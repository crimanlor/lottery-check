<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprobador de Loter√≠a de Nueva York</title>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
</head>

<body>
    <main class="container">
        <header>
            <h1>Comprobador de Loter√≠a de Nueva York (Usando una API, no EJS üòÄ)</h1>
        </header>

        <section class="section">
            <h2>Comprobar Los N√∫meros Premiados De Una Fecha Espec√≠fica</h2>
            <form id="checkNumbersForm">
                <label for="date">Selecciona una fecha:</label>
                <input type="date" id="date" name="date" required>
                <button type="submit">Comprobar</button>
            </form>
            <label for="numbersResult">N√∫meros premiados:</label>
            <input type="text" id="numbersResult" readonly></div>
        </section>

        <section class="section">
            <h2>Comprobar Tus N√∫meros</h2>
            <form id="checkYourNumberForm">
                <label for="yourDate">Selecciona una fecha:</label>
                <input type="date" id="yourDate" name="yourDate" required>
                <label for="yourNumbers">Introduce tus n√∫meros (separados por espacio):</label>
                <input type="text" id="yourNumbers" name="yourNumbers" placeholder="Ejemplo: 12 34 56 78 90 12 34"
                    required pattern="\d+(\s\d+){0,6}">
                <button type="submit">Comprobar</button>
            </form>
            <label for="yourNumbersResult">Cantidad de aciertos y premio obtenido:</label>
            <input type="text" id="yourNumbersResult" readonly></div>
        </section>
    </main>

    <script>
        document.querySelector('#checkNumbersForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const date = document.getElementById('date').value;
            // TODO: Realizar llamada al servidor. Procesar los datos y rellenar adecuadamente el DIV:

            // 1. Usar m√©todo fetch para hacer una petici√≥n de tipo get a api/check-date
            const response = await fetch(`api/check-date?date=${date}`)

            // 2. Tenemos que pasarle una query string a la URL que vamos a consumir: /api/check-date?date=2020-09-25

            // 3. Tenemos que procesar la respuesta de la API. La estructura es:
            /**
             * {
             *    "message" : "Draw found",
             *    "winningNumbers": "20 36 37 48 67 16 02"
             * }
             */
            const data = await response.json()

            if(response.ok){
                // 4. Tenemos que coger la propiedad winningNumbers de est respuesta y meterla en el #numbersResult
                document.querySelector('#numbersResult').value = data.winningNumbers
            } else {
                document.querySelector('#numbersResult').value = data.message
            }   

        });

        document.querySelector('#checkYourNumberForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const date = document.getElementById('yourDate').value;
            const yourNumbers = document.getElementById('yourNumbers').value;
            
            // 1. Usar m√©todo fetch para hacer una petici√≥n de tipo get a /api/get-computed-results, con los valores de la query string a consumir
            const response = await fetch(`/api/get-computed-results?date=${date}&playedNumbers=${yourNumbers}`);

            // 3. Tenemos que procesar la respuesta de la API. La estructura es:
            /**
             * {
             *    message: "Draw found",
                  matchedNumbers: matchedNumbers.length,
                  prize: prize
             * }
             */

            const data = await response.json()

            if(response.ok){
                // 4. Tenemos que coger la propiedad winningNumbers de esta respuesta y meterla en el #numbersResult
                document.querySelector('#yourNumbersResult').value = `Has acertado ${data.matchedNumbers} n√∫meros. Su premio es de : ${data.prize} $`
            } else {
                document.querySelector('#yourNumbersResult').value = data.message
            }      
        });
    </script>
</body>

</html>